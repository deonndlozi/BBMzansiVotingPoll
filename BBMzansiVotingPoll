<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>100-Vote Poll – One-Shot</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .poll-container{background:white;border-radius:20px;padding:40px;box-shadow:0 20px 60px rgba(0,0,0,.1);max-width:600px;width:100%}
    .poll-title{font-size:28px;margin-bottom:10px;color:#333;text-align:center}
    .poll-description{color:#666;text-align:center;margin-bottom:10px}
    .option{display:flex;justify-content:space-between;align-items:center;background:#f8f9fa;border:2px solid #e9ecef;border-radius:12px;padding:20px;margin-bottom:15px}
    .option-text{font-size:16px;font-weight:500}
    .vote-input{width:80px;padding:10px;border:2px solid #ddd;border-radius:8px;text-align:center;font-size:16px}
    .vote-input:focus{outline:none;border-color:#667eea}
    .vote-input:invalid{border-color:#dc3545;background:#fff5f5}
    .main-vote-btn{width:100%;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;padding:18px;border-radius:12px;font-size:18px;font-weight:600;cursor:pointer;margin-top:20px}
    .stats{margin-top:25px;background:#f8f9fa;border-radius:10px;padding:20px}
    .stat-bar{margin-bottom:15px}
    .stat-label{display:flex;justify-content:space-between;font-size:14px;color:#666}
    .progress-bar{height:8px;background:#e9ecef;border-radius:4px;overflow:hidden}
    .progress-fill{height:100%;background:linear-gradient(90deg,#667eea,#764ba2);border-radius:4px;transition:width .6s}
    .total-votes{margin-top:15px;padding:15px;background:#e8f4fd;border-radius:8px;text-align:center;font-weight:600;color:#2c5aa0}
    #votingSection{}
    #closedBanner{display:none;text-align:center;font-size:18px;font-weight:600;color:#28a745;margin-bottom:20px}
  </style>
</head>
<body>
  <div class="poll-container">
    <h2 class="poll-title">What's Your Favorite Programming Language?</h2>
    <p class="poll-description">Distribute up to 100 total votes among the options.</p>

    <!-- Voting area -->
    <div id="votingSection">
      <div class="poll-options"></div>
      <button class="main-vote-btn" onclick="submitVotes()">VOTE</button>
    </div>

    <!-- After 100 votes -->
    <div id="closedBanner">Voting is now closed – thank you!</div>

    <!-- Results -->
    <div class="stats">
      <h4>Poll Results</h4>
      <div id="resultsContainer"></div>
      <div class="total-votes" id="totalVotes">Total Votes: 0</div>
    </div>
  </div>

  <script>
    const OPTIONS = ['javascript','python','java','csharp','go'];
    const DISPLAY = {javascript:'JavaScript',python:'Python',java:'Java',csharp:'C#',go:'Go'};
    const STORAGE = 'manualPoll_final';

    let tempVotes   = Object.fromEntries(OPTIONS.map(o=>[o,0]));
    let recordedVotes = {...JSON.parse(localStorage.getItem(STORAGE)||'{}')};
    OPTIONS.forEach(o=> recordedVotes[o] = recordedVotes[o] || 0);

    const getTotal = o=> Object.values(o).reduce((a,b)=>a+b,0);
    function save(){ localStorage.setItem(STORAGE, JSON.stringify(recordedVotes)); }

    function submitVotes(){
      const total = getTotal(tempVotes);
      if(total===0){ alert('Add some votes first'); return; }
      Object.assign(recordedVotes,tempVotes);
      save();
      showResults();
      // Hide only when 100 votes reached
      if(getTotal(recordedVotes)>=100){
        document.getElementById('votingSection').style.display='none';
        document.getElementById('closedBanner').style.display='block';
      }
    }

    function buildBoxes(){
      const cont=document.querySelector('.poll-options');
      cont.innerHTML='';
      OPTIONS.forEach(opt=>{
        cont.insertAdjacentHTML('beforeend',`
          <div class="option" data-opt="${opt}">
            <div class="option-text">${DISPLAY[opt]}</div>
            <input type="number" class="vote-input" min="0" max="100" value="${tempVotes[opt]}" aria-label="Votes for ${DISPLAY[opt]}">
          </div>`);
        cont.lastElementChild.querySelector('.vote-input')
             .addEventListener('input', e=>{
               const num=Math.max(0,Math.min(100,parseInt(e.target.value)||0));
               const others=getTotal(tempVotes)-tempVotes[opt];
               tempVotes[opt]=Math.min(num,100-others);
               e.target.value=tempVotes[opt];
             });
      });
    }

    function showResults(){
      const total=getTotal(recordedVotes);
      const sorted=OPTIONS.map(opt=>({name:DISPLAY[opt],votes:recordedVotes[opt]}))
                          .sort((a,b)=>b.votes-a.votes);
      const res=document.getElementById('resultsContainer');
      res.innerHTML='';
      sorted.forEach(({name,votes})=>{
        const pct=total?(votes/total*100).toFixed(1):0;
        res.insertAdjacentHTML('beforeend',`
          <div class="stat-bar">
            <div class="stat-label"><span>${name}</span><span>${votes} votes (${pct}%)</span></div>
            <div class="progress-bar"><div class="progress-fill" style="width:${pct}%"></div></div>
          </div>`);
      });
      document.getElementById('totalVotes').textContent = `Total Votes: ${total}`;
    }

    document.addEventListener('DOMContentLoaded',()=>{
      if(getTotal(recordedVotes)>=100){
        document.getElementById('votingSection').style.display='none';
        document.getElementById('closedBanner').style.display='block';
      }else{
        buildBoxes();
      }
      showResults();
    });
  </script>
</body>
</html>
